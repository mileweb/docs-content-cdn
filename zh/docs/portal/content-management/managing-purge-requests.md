# 内容管理

CDN Pro 提供的缓存刷新功能可以让您快速更新缓存文件。此功能可用于当您的 Web 服务器（源站）上的内容发生更改并且您希望 CDN Pro 立即使用新文件响应客户端的时候。例如，如果您的网站的缓存时间为一周，但您希望网站访问者看到您在某个页面的更新，您就可以使用缓存刷新功能来刷新缓存从而让访问者查阅到最新内容。

您可以从内容管理页面执行缓存刷新操作。要展示此页面，请单击左窗格中的 **内容管理**。

下图显示了该页面上的关键元素，图后面的表格描述了它们内容。

![null](</docs/resources/images/content-management/content-management-w-numbers.png>)

| **字段** | **描述** |
| :----------: | --------------- |
| 1 | 用于过滤缓存刷新任务，请在此字段中键入字符，然后按 Enter 键。系统将仅展示包含键入字符的缓存刷新任务。该过滤不区分大小写。要删除该过滤操作，请单击搜索字段右侧的 **x** 图标。|
| 2 | 每个缓存刷新任务都出现在此行中。单击 ID 系统会显示有关缓存刷新任务的详细信息。|
| 3 | 按提交日期过滤缓存刷新任务的图标。|
| 4 | 创建缓存刷新任务请求的按钮。|

## 创建刷新任务

如果 Web 服务器（源站）上的内容已更改，您可以新建刷新任务以便 CDN Pro 分发最新文件。

1. 在左侧窗格中，单击**内容管理**。
2. 在页面的右上角，单击 **新建刷新任务** 按钮。
3. 填写刷新任务表单中的字段。必填字段由星号 (```*```) 表示。表格顶部显示当前可用的每日文件刷新额度。


<p align=center><img src="/docs/resources/images/content-management/purge-form.png" alt="purge form" width="600"></p>

|**字段**|**描述**|
|----------|---------------|
| 目标环境 | 选择是否在演练环境或生产环境中执行刷新任务。默认为演练环境。|
| 刷新方式 | 选择是要直接删除内容还是使其过期无效。<br><ul><li><strong>删除</strong> = 从边缘服务器的缓存中删除对象。当下次边缘服务器收到本次删除内容的请求时，它会从您的源服务器检索当前版本文件。(*默认*)</li><li><strong>强制过期</strong> = 默认设置，将缓存的内容标记为过期。但是，该刷新方式并不会从缓存中删掉内容。当下次边缘服务器收到本次删除内容的请求时，只有在源上文件版本比陈旧的缓存更新时， CDN Pro 才会去源上检索该文件。使用此设置，如果无法访问源，CDN Pro 边缘服务器可以继续为您的终端用户提供陈旧的内容。</li></ul> |
| 刷新类型 | 选择是要清除单个文件、清楚匹配通配符的多个缓存内容，或匹配正则表达式的所有内容。默认类型为文件。有关使用正则表达式进行刷新的更多信息，请查阅下方的 [使用正则刷新任务](#purging-entries-that-match-a-regular-expression) 。<br><br><strong>请注意：</strong> 如果一个文件因自定义 Cache Key 导致存在多个缓存版本，请使用 **通配符（目录）刷新**.</br>|
| 添加要清除的文件 | 当 **刷新类型** 是 **文件** 时，输入要清除的文件的完整 URL，然后按下Enter回车键。对要清除的每个文件重复此步骤。如果您决定不刷新该文件，请将其从该字段中删除。|
| 添加一个文件刷新请求头 | 当 **刷新类型** 是 **文件** 时，指定缓存键中包含的 HTTP 请求标头的名称和值，然后单击 **添加请求头**。对要刷新的每个附加请求头重复此步骤。如果您决定不刷新某个请求头，请单击该请求头名称右侧的 **x** 图标。|
| 添加要刷新的目录 | 当 **刷新类型** 是 **通配符** 时，输入要清除的目录的完整 URL，包括可选的通配符，然后按 下Enter回车键。对要刷新的每个其他目录重复此步骤。如果您决定不刷新该目录，请将其从该字段中删除。</br><br><strong>注意：</strong> 请遵守以下准则：</br><ul><li>刷新某目录也会刷新其子目录。</br></ul></li><ul><li>CDN Pro 支持基于 URL 前缀的清除。有关详细信息，请参阅下方的 [通配符（目录）刷新示例](#examples-of-directory-purging) 。</ul></li>|

4. 点击 **开始刷新**.<br><br> 
   
   **注意：** 刷新任务完成后，刷新任务详情页面右下角的 **再次刷新** 按钮可让您重复执行此次刷新任务。


## 创建正则刷新任务

CDN Pro 支持使用正则表达式（或“正则表达式”）模式来匹配缓存键的清除。模式必须以 `{scheme}://{hostname}` 开头，其中 <code>{scheme}</code> 是 http、https 或其他请求协议的条目。例如：<br><br><code>https://test.domain.com/my.*\.(jpg|png)\?q= </code></br></br>

出于性能考虑，请遵守以下准则：
<ul><li>域名后面的正则表达式长度应小于 126字符。</ul></li><ul><li>该模式最多可以包含两个无限量词（“*”、“+”或",}")</ul></li><ul><li>任何量词的上限不能超过59。</ul></li>

默认情况下，CDN Pro 允许您一次性提交1000条 <code>fileUrls</code> 文件刷新，20条<code>dirUrls</code> 通配符（目录）刷新，以及2条 <code>regexPatterns</code> 正则刷新。每个请求可携带条数和每日允许的刷新总数取决于每个客户账号特定的配额。 除此以外 CDN Pro 还限制了 API 请求正文的大小。


**注意：** 如果您是代理商客户，您将有权限对子客户的域名进行刷新。此时刷新将消耗您自身账号的额度。

## 通配符（目录）刷新示例

CDN Pro 允许您通过<strong>指定目标目录</strong> 的方式来刷新整个目录下的文件。您输入的 URL 可以包含通配符。
<ul><li>以单个星号结束子目录 <b>*</b> 仅清除本层级下所有文件。</ul></li><ul><li>以两个星号结束目录将清除本层级下所有文件以及所有子层级中的文件</ul></li><ul><li>以 <b>*ext</b> 结束 URL 会清除所有具有特定扩展名的文件。</ul></li><ul><li>如果目标 URL 包含百分比字符 <b>%</b>，则将其编码为 <b>%25</b>。</ul></li>

下表显示了使用和不使用通配符刷新目录的示例。


**注意：** 如果您在边缘逻辑中使用了自定义缓存键，那么同一个 URL 文件可以有多个缓存版本。此外，如果开启了 Vary 缓存功能，诸如 <code>/pictures/</code> 或 <code>/picture.jpg</code> 之类的 URL 便可以在缓存中存储许多缓存版本。因此，执行不带星号的文件夹刷新会刷新掉除子目录或文件之外的所有缓存版本。<code>/pictures/</code>、<code>/pictures/*</code> 和 <code>/pictures/**</code> 的文件夹刷新任务将会最终导致不同的刷新结果。



|**示例**|**描述**|
|----------|---------------|
| http://test.domain2.com/mydir       | 刷新单个目录的所有缓存版本，但不刷新其子目录或文件。如果您在配置中使用了自定义缓存键，则同一个URL可能存在不同缓存版本。                               |
| http://test.domain2.com/mydir/**    | 刷新所有以缓存键 http://test.domain2.com/mydir/ 开头的文件和子目录。                               |
| http://test.domain2.com/mydir/*    | 刷新mydir目录下的所有文件，但不刷新其子目录。                                             |
| http://test.domain2.com/mydir/*.jpg | 刷新所有以 .jpg 文件扩展名结尾的缓存条目。 http://test.domain2.com/mydir/ 的子目录不会被清除。                                             |
| http://test.domain2.com/mydir/a*    | 刷新所有以字母“a”开头的文件，但不清除子目录。                   |
| http://test.domain2.com/mydir/a**   | 刷新所有以字母“a”开头的文件和子目录。|
| http://test.domain2.com/mydir/a.jpg | 刷新“a.jpg”的所有缓存版本。如果您在配置中使用了自定义缓存键，则同一个URL可能存在不同缓存版本。                                  |
| http://test.domain2.com/my**jpg | 刷新缓存键以 http://test.domain2.com/my 开头并以后缀 jpg 结尾的所有条目。 “**”可以匹配路径中的任何内容，包括其他子目录。例如，http://test.domain2.com/mydirectory/picture.jpg 将被清除。                                  |                                  |


## 查看刷新任务详细信息

1. 在左侧窗格中，单击**内容管理**。
2. 单击与刷新任务关联的 ID。刷新任务详细表单将展示有关所选刷新操作的详细信息。

## 查看刷新历史任务

1. 在左侧窗格中，单击**内容管理**。
2. 内容管理页面将显示类似于下图的详细信息：

   <ul><li> 与刷新任务关联的 ID。<br>
   <li>与刷新请求关联的域名。<br><li>刷新任务下发的的目标环境（演练或生产环境）。<br>
   <li>刷新方式（删除或者强制过期）。<br>
   <li>刷新的文件和目录数。<br>
   <li>刷新任务的提交时间和完成时间<br>
   <li>显示该刷新任务的成功率（比例从 0 到 100%）</ul>

<p align=center><img src="/docs/resources/images/content-management/content-management-wo-numbers.png" alt="purge form no numbers" width="900"></p>

